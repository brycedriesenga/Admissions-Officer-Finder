<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Animated United States map made with Raphael</title>  
  
  <style type="text/css">
  	body {
  		background-color:#f6f6f6;
  	}
  	
  	div#dialog {
  		display:block;
  		width:300px;
  		height:300px;
  		background-color:white;
  		position:absolute;
  		right:0px;
  		top:100px;
  	}
      
#modal:target {
    display: table;
    height: 100%;
}

#modal {
    background: none repeat scroll 0 0 rgba(0, 0, 0, 0.5);
    display: none;
    height: 100%;
    left: 0;
    position: absolute;
    top: 0;
    width: 100%;
    z-index: 999;
}

#modal h1, #modal p {
    width:500px;
    display:block;
    margin:0 auto;
}

#modal a {
    display: table-cell;
    text-align: center;
    vertical-align: middle;
}

  </style>
</head>
<body>

<div id="modal">
<a href="#close">
    <h1> Select your state and country* to find an admissions counselor that represents your area.</h1>
    <p>*Applicable only to Michigan residents.</p>
    <p>Please note that these territories are non-exclusive. Any member of ourstaff is qualified and willing to assist you.</p>
</a>
</div>

<div id="container"></div>

<div id="dialog"></div>
<!-- /container -->  

<script id="officer-template" type="text/x-handlebars-template">
	<div div="officer">
	  <h1>{{name}}</h1>
	  <h3>Email:</h3>
	  <p>{{email}}</p>
	  <img src="placeholder.jpg"/>
	</div>
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script src="handlebars.js"></script>
<script src="raphael-min.js"></script>
<script src="us-map-svg.js"></script>
<script type="text/javascript">
  
  officerCollection = {
  	1 : {
  		name : "Person 1",
  		email : "person1@host.com",
  		states : [ "ak","hi", "wa", "or", "ca", "id","nv","az","mt","wy","co","ut","nm" ]
  	},
  	2 : {
  		name: "Person 2",
  		email : "person2@host.com",
  		states : [ "ks","ok","tx","nd","sd","ne","mn","ia","mo","ar","la" ]
  	},
  	3 : {
  		name : "Person 3",
  		email : "person3@host.com",
  		states : [ "wi","il","ms","mi","ind","ky","tn","al","oh","ga","fl" ]	
  	},
  	4 : {
  		name : "Person 4",
  		email : "person4@host.com",
  		states : [ "ny","pa","md","wv","va","nc","sc","me","nh","vt","ma","ri","ct","nj","de" ]
  	}
  }

  window.onload = function () {
    var R = Raphael("container", 1000, 900),
      attr = {
      "fill": "#d3d3d3",
      "stroke": "#fff",
      "stroke-opacity": "1",
      "stroke-linejoin": "round",
      "stroke-miterlimit": "4",
      "stroke-width": "0.75",
      "stroke-dasharray": "none"
    };
    
    usRaphael = {};
    
    officerLookup = {};
      
    for ( var officer in officerCollection ) {
        
        for ( var state in officerCollection[officer].states){
            officerLookup[ officerCollection[officer].states[state] ] = officerCollection[officer] ;
        }(officerCollection, officerLookup)
          
      }(officerCollection, officerLookup)
    
    //Draw Map and store Raphael paths
    for (var state in usMap) {
	  var officer = officerLookup[state];
	  
      var path = R.path(usMap[state]).attr(attr);
      path.name = state;
      usRaphael[state] = path;
      //officer.states[state] =
    };
  
    
    //Do Work on Map
    for (var state in usRaphael) {
      usRaphael[state].color = Raphael.getColor();
      
      (function (st, state) {
        
        current = null;
        
        st[0].style.cursor = "pointer";
		
		st[0].onmousedown = function() {
			var state = this.raphael.name;
			var officer = officerLookup[state];
			
			var source   = $("#officer-template").html();
			var template = Handlebars.compile(source);

			var context = { name: officer.name, email: officer.email }
			var html    = template(context)
			$('div#dialog').empty();
			$('div#dialog').append(html);
			
			//alert(officer.name);
			
		};
		
        st[0].onmouseover = function () {
          if (current != this.raphael.name) {
              current = this.raphael.name;
              var nstate = this.raphael.name;
              var officer = officerLookup[nstate];
              
              for(state in officer.states){
              	  usRaphael[ officer.states[state] ].animate({fill: "#bbb"}, 100);
              }
    
              st.animate({fill: "#777777" }, 100);
    
              st.toFront();
              R.safari();
           }
        };
        
        st[0].onmouseout = function () {
          current = null;
          var nstate = this.raphael.name;
          
          var officer = officerLookup[nstate];
          
          for(stte in usRaphael){
              usRaphael[ stte ].animate({fill: "#d3d3d3"}, 100);
          }

          st.toFront();
          R.safari();
        };
                   
      })(usRaphael[state], state);
    };
  }
</script>
</body>
</html>